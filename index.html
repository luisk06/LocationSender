<!DOCTYPE html>
<html>
  <head>
    <title>Device Properties Example</title>
     <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
     <link rel="stylesheet" href="css/loginstyle1.css" />
    <style>
			#map{
					height:300px;
					width:100%;
					padding:0;
					righ:0px;
					bottom:0px !important;
					left:0px !important;
				}
				#wrapper {
					padding:10px;
					}
				#outputDiv {
					display: inline-block;
					width:95%;
					top:0px;
					border: 1px solid green;
				}
				#outputDiv2 {
					display: inline-block;
					width:95%;
					top:0px;
					
					border: 1px solid green;
				}
				#lol{
				overflow-y:scroll;
				height:300px;
				}
				
				
				
				
				
				
				
	</style>
	<script src="js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
      <script src="js/jquery.mobile-1.4.5.min.js"></script> 
    <script type="text/javascript" charset="utf-8">
	
	

    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);

    // device APIs are available
    //
    function onDeviceReady() {
	
		 navigator.geolocation.getCurrentPosition(onSuccess, onError);
      
    }

    // onSuccess Geolocation
    //
    function onSuccess(position) {
  	
        var element = document.getElementById('geolocation');
        element.innerHTML = 'Latitude: <input type="text" id="latitude" name="latitude" value="'           + position.coords.latitude              + '" /><br />' +
                            'Longitude: <input type="text" id="longitude" name="longitude" value="'          + position.coords.longitude             + '" /><br />' +
                            'Altitude: '           + position.coords.altitude              + '<br />';
              
    }

    // onError Callback receives a PositionError object
    //
    function onError(error) {
        alert('code: '    + error.code    + '\n' +
              'message: ' + error.message + '\n');
    }

    </script>
 
  </head>
  <body>
  <div data-role="page" id="page1">
  	<div data-role="header">
    	<div><img width="100%" src="css/logo.png" style="padding-top:15px; padding-left:15px"/></div>
    </div>
  	<div class="inputstyle">
  		<div role="main" class="ui-content">
        	
        	<p id="geolocation">Finding geolocation...</p>
            	<!--<div><input type="text" id="user_name" name="user_name" value="" placeholder="your code" style="width:50%"/></div>-->
                <div>
                    <select id="user_name">
                        <option value="">Choose user...</option>
                         <option value="1">David Bell</option>
                         <option value="2">Roberto Cadena</option>
                         <option value="3">Willmar Marin</option>
                         <option value="4">Hernando Pe&ntilde;a</option>
                         <option value="5">Luis Morillo</option>
                    </select>
                </div>
                <br />
            	<!--<div><input type="button" value="SEND LOCATION" id="send_data" name="send_data" style="width:50%" /></div> -->
            	<div><a href="#" id="send_data1" name="send_data1" class="btn-class2">SEND LOCATION</a></div>
     	</div>
     </div>
   </div>
   
   
   
   
   <div data-role="listpage" id="page1_1">        	
        	<div data-role="header">
            	<h1> <a href="#page1" id="back" class="btn-class2"> Back</a></h1>
            </div>
            		<div><h1>ACTIVE LOADS</h1></div>
				<div role="listpage" class="ui-content" id="lol">
					<p id="lol_item">Loading...</p>
				 </div>
	        <!--	<div><a href="#" id="send_data2" name="send_data2">SEND LOCATION</a></div> -->
    </div>
	
	
	
	
   
    <div data-role="page" id="page2" data-url="map-page">        	
        	<div data-role="header">
            	<h1> <a href="#page1_1" id="back" class="btn-class2"> Back</a></h1>
            </div>
            <div role="mappage" class="ui-content">
                <div id="map"></div>
                <div id="wrapper">
                <table>
                	<tr><td>To PickUp Place</td><td>To Destination</td></tr>
                 	<tr>
                    	<td>
                        	<div  id="outputDiv"></div>
                        </td>
                        <td>
                        	<div  id="outputDiv2"></div>
                        </td>
                    </tr>
                    <tr>
                    <td >
                        	<div><a href="#" id="send_data3" name="send_data3" class="btn-class2">GET SIGNATURE</a></div>
                        </td>
                     </tr>
                </table>    
                </div>
             </div>
    </div>
    
    <div data-role="" id="page3">
			<div data-role="header">
            	<h1> <a href="#page2" id="back3" class="btn-class2"> Back</a></h1>
            </div>
			<div id="content">
				<div id="signatureparent">
					<div id="signature"></div>
				</div>
			</div>
			<div style="margin-top: 2cm;">
				<a href="#" id="" class="btn-class2">SAVE SIGNATURE</a>
			</div>
    </div>
	
	
		<script>
		
		function send_to_db(x,y){ 
                    var lati = x;//$('#latitude').val();
                    var longi = y;// $('#longitude').val();
			var name = $('#user_name').val();
                        $.ajax({
                            type: 'POST',
                            data: {user_lat: lati, user_long: longi, user_name: name},
                            url: 'http://leanstaffing.com/testserver/save.php',
                            success: function(data){
                                console.log(data);
                               // alert('Your location was successfully added');
                            },
                            error: function(){
                                console.log(data);
                                alert('There was an error adding your location');
                            }})
		}
			
		
			 $('#send_data1').click(function(){
				var id_driver = $('#user_name').val();
				alert('prueba');
				 $.ajax({
                            	type: 'POST',
				dataType: 'json',
	                        url: 'http://lean-staffing.com/trackngo/load/get_load/'+id_driver,
	                            success: function(data){
	                                console.log(data);
								//alert(data[0].dp_long);
								alert(data[0].idts_load);//-96.8141;//data[0].dp_long;
								var load_item = document.getElementById('lol_item');
								var test1 = parseFloat(data[0].idts_load);
									for(i=0;i<data.length;i++){
										load_item.innerHTML = '<a href="#" style="color: red;" class="" onclick="load_details('+i+')">ITEM : '+data[i].customer+'</a><br />';
										}
										location.href = "#page1_1";
										
										
										setInterval(function(){ 
											 	navigator.geolocation.getCurrentPosition(onSuccess, onError);
											 	  function onSuccess(position) {
												  	 var x = position.coords.latitude;
												         var y = position.coords.longitude;
												         send_to_db(x,y);
											 	  }
											 	   function onError(error) {
												        alert('code: '    + error.code    + '\n' +
												              'message: ' + error.message + '\n');
												    }
											 },10000);
										
										
										
                                //alert('Your location was successfully added');
                            },
                            error: function(data){
                                console.log(data);
                                alert('There was an error adding your location');
                            }})
				
			 });
		</script>
			<script>
            function load_details(ix){
				 //location.href("#page2");
				 location.href = "#page2";
				   alert($('#latitude').val());
			
                    var latitude_driver = parseFloat($('#latitude').val());//37.55;
                    var longitude_driver = parseFloat($('#longitude').val());//-77.44;
		    var id_driver = $('#user_name').val();
                        $.ajax({
                            type: 'POST',
							dataType: 'json',
                            //data: {driver: id_driver},
                            url: 'http://lean-staffing.com/trackngo/load/get_load/'+id_driver,
                            success: function(data){
                                console.log(data);
								//alert(data[0].dp_long);
								alert(parseFloat(data[ix].dp_long));//-96.8141;//data[0].dp_long;
								

								
								var latitude_pickup = parseFloat(data[ix].pk_lat);
								var longitude_pickup =parseFloat(data[ix].pk_long);
								var latitude_drop = parseFloat(data[ix].dp_lat);
								var longitude_drop = parseFloat(data[ix].dp_long);
								initMap1(latitude_driver, longitude_driver, latitude_pickup, longitude_pickup, latitude_drop, longitude_drop);
                                //alert('Your location was successfully added');
                            },
                            error: function(data){
                                console.log(data);
                                alert('There was an error adding your location');
                            }})
                       
                      //return false;
                };
          </script>
          <!----------------------- Map, Distance , Time ------------------------------->
          
          <script>
					function initMap1(latitude_driver, longitude_driver, latitude_pickup, longitude_pickup, latitude_drop, longitude_drop) {
					  var bounds = new google.maps.LatLngBounds;
					  var markersArray = [];
					
					  var origin1 = {lat: latitude_driver, lng: longitude_driver};
					  var destinationA = {lat: latitude_pickup, lng: longitude_pickup};
					  var origin2 = {lat: latitude_pickup, lng: longitude_pickup};
					  var destinationB = {lat: latitude_drop, lng: longitude_drop};
					
					  var destinationIcon = 'https://chart.googleapis.com/chart?' +
						  'chst=d_map_pin_letter&chld=D|FF0000|000000';
					  var originIcon = 'https://chart.googleapis.com/chart?' +
      						'chst=d_map_pin_letter&chld=O|FFFF00|000000';
					  var map = new google.maps.Map(document.getElementById('map'), {
						//center: {lat: 55.53, lng: 9.4},
						center: {lat: latitude_driver, lng: longitude_driver},
						zoom: 7
					  });
					  var geocoder = new google.maps.Geocoder;
					
					  var service = new google.maps.DistanceMatrixService;
					  service.getDistanceMatrix({
						origins: [origin1, origin2],
						destinations: [destinationA, destinationB],
						travelMode: google.maps.TravelMode.DRIVING,
						unitSystem: google.maps.UnitSystem.METRIC,
						avoidHighways: false,
						avoidTolls: false
					  }, function(response, status) {
						if (status !== google.maps.DistanceMatrixStatus.OK) {
						  alert('Error was: ' + status);
						} else {
						  var originList = response.originAddresses;
						  var destinationList = response.destinationAddresses;
						  var outputDiv = document.getElementById('outputDiv');
						  var outputDiv2 = document.getElementById('outputDiv2');
						  outputDiv.innerHTML = '';
						  outputDiv2.innerHTML = '';
						  deleteMarkers(markersArray);
						   
					
						  var showGeocodedAddressOnMap = function(asDestination) {
							var icon = asDestination ? destinationIcon : originIcon;
							return function(results, status) {
							  if (status === google.maps.GeocoderStatus.OK) {
								map.fitBounds(bounds.extend(results[0].geometry.location));
								markersArray.push(new google.maps.Marker({
								  map: map,
								  position: results[0].geometry.location,
								  icon: icon
								}));
							  } else {
								alert('Geocode was not successful due to: ' + status);
							  }
							};
						  };
					
						 /* for (var i = 0; i < originList.length; i++) {
							var results = response.rows[i].elements;
							  geocoder.geocode({'address': originList[i]},
								  showGeocodedAddressOnMap(false));
							for (var j = 0; j < results.length; j++) {
							  geocoder.geocode({'address': destinationList[j]},
								  showGeocodedAddressOnMap(true));
							  outputDiv.innerHTML += '<b>' + originList[i] + ' to ' + destinationList[j] +
								  ': ' + results[j].distance.text + ' in ' +
								  results[j].duration.text + '</b>' + '<br>';
								  alert(j);
							}
						  }
						  */
						  
						  for (var i = 0; i < 1; i++) {
							var results = response.rows[i].elements;
							  geocoder.geocode({'address': originList[i]},
								  showGeocodedAddressOnMap(false));
							for (var j = 0; j < 1; j++) {
							  geocoder.geocode({'address': destinationList[j]},
								  showGeocodedAddressOnMap(true));
							  outputDiv.innerHTML += '<b>' + originList[i] + ' to ' + destinationList[j] +
								  ': ' + results[j].distance.text + ' in ' +
								  results[j].duration.text + '</b>' + '<br>';
								 
							}
						  }
						  
						  for (var i = 1; i < 2; i++) {
							var results = response.rows[i].elements;
							  geocoder.geocode({'address': originList[i]},
								  showGeocodedAddressOnMap(false));
							for (var j = 1; j < 2; j++) {
							  geocoder.geocode({'address': destinationList[j]},
								  showGeocodedAddressOnMap(true));
							  outputDiv2.innerHTML += '<b>' + originList[i] + ' to ' + destinationList[j] +
								  ': ' + results[j].distance.text + ' in ' +
								  results[j].duration.text + '</b>' + '<br>';
								 
							}
						  }
						  
						  
						
						}
					  });
					}
					
					function deleteMarkers(markersArray) {
					  for (var i = 0; i < markersArray.length; i++) {
						markersArray[i].setMap(null);
					  }
					  markersArray = [];
					}

    	</script>
    <script src="https://maps.googleapis.com/maps/api/js?signed_in=true&callback=initMap1" async defer></script>
<!-----------------------END OF   Map, Distance , Time ------------------------------->
          
          
		  
		  


<script src="js/jSignature.min.noconflict.js"></script>
<script>
/* SIGNATURE DETAILS
*/
(function($){

$('#send_data3').click(function() {
	$('#thisisundo').removeClass('ui-btn ui-input-btn ui-corner-all ui-shadow');
	location.href = "#page3";
	// This is the part where jSignature is initialized.
	var $sigdiv = $("#signature").jSignature({'UndoButton':true})
	
	// All the code below is just code driving the demo. 
	, $tools = $('#tools')
	, $extraarea = $('#displayarea')
	, pubsubprefix = 'jSignature.demo.'
	
	var export_plugins = $sigdiv.jSignature('listPlugins','export')
	, chops = ['<span><b>Extract signature data as: </b></span><select>','<option value="">(select export format)</option>']
	, name
	for(var i in export_plugins){
		if (export_plugins.hasOwnProperty(i)){
			name = export_plugins[i]
			chops.push('<option value="' + name + '">' + name + '</option>')
		}
	}
	chops.push('</select><span><b> or: </b></span>')
	
	$(chops.join('')).bind('change', function(e){
		if (e.target.value !== ''){
			var data = $sigdiv.jSignature('getData', e.target.value)
			$.publish(pubsubprefix + 'formatchanged')
			if (typeof data === 'string'){
				$('textarea', $tools).val(data)
			} else if($.isArray(data) && data.length === 2){
				$('textarea', $tools).val(data.join(','))
				$.publish(pubsubprefix + data[0], data);
			} else {
				try {
					$('textarea', $tools).val(JSON.stringify(data))
				} catch (ex) {
					$('textarea', $tools).val('Not sure how to stringify this, likely binary, format.')
				}
			}
		}
	}).appendTo($tools)

	
	$('<input type="button" value="Reset">').bind('click', function(e){
		$sigdiv.jSignature('reset')
	}).appendTo($tools)
	
	$('<div><textarea style="width:100%;height:7em;"></textarea></div>').appendTo($tools)
	
	$.subscribe(pubsubprefix + 'formatchanged', function(){
		$extraarea.html('')
	})

	$.subscribe(pubsubprefix + 'image/svg+xml', function(data) {

		try{
			var i = new Image()
			i.src = 'data:' + data[0] + ';base64,' + btoa( data[1] )
			$(i).appendTo($extraarea)
		} catch (ex) {

		}
		
		var message = [
			"If you don't see an image immediately above, it means your browser is unable to display in-line (data-url-formatted) SVG."
			, "This is NOT an issue with jSignature, as we can export proper SVG document regardless of browser's ability to display it."
			, "Try this page in a modern browser to see the SVG on the page, or export data as plain SVG, save to disk as text file and view in any SVG-capabale viewer."
           ]
		$( "<div>" + message.join("<br/>") + "</div>" ).appendTo( $extraarea )
	});

	$.subscribe(pubsubprefix + 'image/svg+xml;base64', function(data) {
		var i = new Image()
		i.src = 'data:' + data[0] + ',' + data[1]
		$(i).appendTo($extraarea)
		
		var message = [
			"If you don't see an image immediately above, it means your browser is unable to display in-line (data-url-formatted) SVG."
			, "This is NOT an issue with jSignature, as we can export proper SVG document regardless of browser's ability to display it."
			, "Try this page in a modern browser to see the SVG on the page, or export data as plain SVG, save to disk as text file and view in any SVG-capabale viewer."
           ]
		$( "<div>" + message.join("<br/>") + "</div>" ).appendTo( $extraarea )
	});
	
	$.subscribe(pubsubprefix + 'image/png;base64', function(data) {
		var i = new Image()
		i.src = 'data:' + data[0] + ',' + data[1]
		$('<span><b>As you can see, one of the problems of "image" extraction (besides not working on some old Androids, elsewhere) is that it extracts A LOT OF DATA and includes all the decoration that is not part of the signature.</b></span>').appendTo($extraarea)
		$(i).appendTo($extraarea)
	});
	
	$.subscribe(pubsubprefix + 'image/jsignature;base30', function(data) {
		$('<span><b>This is a vector format not natively render-able by browsers. Format is a compressed "movement coordinates arrays" structure tuned for use server-side. The bonus of this format is its tiny storage footprint and ease of deriving rendering instructions in programmatic, iterative manner.</b></span>').appendTo($extraarea)
	});

	if (Modernizr.touch){
		$('#scrollgrabber').height($('#content').height())		
	}
	
})

})(jQuery)

</script>
					
					
					
		  
    <script>

/*		setTimeout(function(){
	   			window.location.reload(1);
			}, 100000);*/
	</script>
  </body>
</html>
